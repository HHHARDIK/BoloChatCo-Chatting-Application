{% extends 'chat/base.html' %}

{% block content %}
<style>
  body{
    background-color:#2c2c2c;
    color:#fff;
  }
  .roomnaam{
    display:block;
    width:40px;
    margin:40px auto;
    color:#cbb300;
  }
  .form-control{
    min-height:60px;
  }
  .btn-primary{
    background-color: #cbb300;
    border: 1px solid #fff;
    display: block;
    margin: 5px auto;
  }
</style>
<h2 class="roomnaam"> {{ room }}</h2>

<script>
    $(document).ready(function(){
    
    setInterval(function(){
        $.ajax({
            type: 'GET',
            url : "/getMessages/{{room}}/",
            success: function(response){
                //console.log(response);
                $("#display").empty();
                for (var key in response.messages)
                {
                    var temp="<div class='alert alert-secondary' role='alert'><strong>"+response.messages[key].user+"</strong></b><p>"+response.messages[key].value+"</p><span class='time-left'>"+response.messages[key].date+"</span></div>";
                    $("#display").append(temp);
                }
            },
            error: function(response){
                alert('An error occured')
            }
        });
    },2000);
    })
    </script>

    
<form id="post-form">
    {% csrf_token %}
    <div class="mb-3">
      {% comment %} <label for="exampleInputEmail1" class="form-label">Email address</label> {% endcomment %}
      <input type="hidden" class="form-control" name="username" id="username" value={{username}} >
      <input type="hidden" class="form-control" name="room_id" id="room_id" value={{room_details.id}}>
       {% comment %} <div id="emailHelp" class="form-text">We'll never share your email with anyone else.</div>
    </div>
    <div class="mb-3">
     <label for="exampleInputPassword1" class="form-label">Password</label> {% endcomment %}
      <input type="text" class="form-control" name="message" id="message">
    </div>
    <button type="submit" class="btn btn-primary">Submit</button>
  </form>
  <div id="display">
  
</div>

{% endblock content %}

{% block message_ajax %}
<script type="text/javascript">
    $(document).on('submit','#post-form',function(e){
      e.preventDefault();
  
      $.ajax({
        type:'POST',
        url:'/send',
        data:{
            username:$('#username').val(),
            room_id:$('#room_id').val(),
            message:$('#message').val(),
          csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data){
           alert(data)
        }
      });
      document.getElementById('message').value = ''
    });
  </script>
  
{% endblock message_ajax %}
